## 介绍

xyqlx的记录工具

## 背景

寄托了过多的灵感然而仅仅实现了很小一部分的记录工具

可能是xyq最大和时间最长的前端项目，超过了10000行代码，不过因为有些模块是平级的，并没有那么难以管理

最近，由于经验的增长与自然语言模型的发展，起初的一些想法已经过时

不开源。因为是不为通用需求服务的、也没什么价值的、纯粹的个人项目

## 这是什么

### 底层设定介绍

以一个普通的文本记录（例如日记）为例，我们可以把它视作一个Note类型，这个Note的属性包括：

* id
* 类型（Note）
* 创建时间
* 最后修改时间
* 标题
* 标签
* 内容

内容可以是若干Passage类型，Passage的内容可以是若干Paragraph，Paragraph的内容可以是若干Sentence。Sentence是最小的单位，它的内容是若干个词汇，每个词汇的属性是一个代表内容的字符串和这个词汇的修饰符

这些类型统称为Candies。xyq用MongoDB来存储这些数据，具体的存储方式是将所有Candies存储在一个集合中，每个Candy有唯一的id，并且通过这些id来相互引用

这样细粒度的格式比较方便对记录的某个部分进行特殊的标注（例如强调，链接等）。当输入为纯文本时，xyq用分行和Jieba分词来将其转换为数据库中的格式，反向转换则更容易实现

PS：考虑到GPT的流行代表的自然语言处理发展趋势，这种以词汇为单位的记录方式缺点也很明显。xyq在考虑是否应该将大段文字存放在一起，使用外置信息来实现细粒度标注

当然，都这么细粒度了，那么显然不可能仅支持纯文本。为了创造多媒体类型的Candies，xyq需要统一所有笔记中使用的资源。这些资源的信息作为Activities保存到数据库中，下图是一些Activities的类型

![Activities](activities.png)

介绍就到此为止。显然可以注意到这个繁杂的系统需要勤劳的标注才能发挥作用，这也是xyq一直想改进整体结构的原因，制作这个玩具的目的可不是为了增加自己的工作量啊

那么，为什么不使用现有的笔记软件呢？

其实OneNote是不错的选择，它也是xyq早期的唯一指定笔记工具。弃用的原因是Microsoft停止支持本地版自由导出的OneNote，以及某些功能（例如标签）的缺失。xyq对OneNote程序接口使用和笔记格式的研究基本上是在这个时候进行的

其他的软件大部分是基于Markdown的，xyq对这种格式毫无意见，但是因为受OneNote的影响，xyq非常执着于记录每句话的输入时间，然而Markdown并不支持这种操作（PS：抛开这个数据的意义不谈，现在看来还是有替代方案的）

虽然Candies是相对失败的作品，但是从好的意义上讲，至少它成功保留了xyq生活的一些片段。xyq是一个非常健忘的人，也笃信记忆组成了“自我”的存在。过去的自己是怎样的呢，经历了哪些未来会遗忘的事情呢，会有哪些无意义的思考呢，这种事也就只有现在的自己才会感兴趣吧，这就是Candies的价值所在

### 功能

* 查看最近的Notes
* 根据标签或搜索词筛选Notes
* 以纯文本的形式添加Note
* 查看、添加、编辑与修改Activities
* 给Notes标记tag

### 关于如何实现笔记的同步

既然是实用性的工具，那么当然存在多设备使用的需求。对于小型项目来说，最简单的方案是使用云服务器/云数据库保存数据。因为这个项目是为个人开发的，所以网盘也是一个方便的可选项。最早版本使用Google Drive作为数据存储，后来改用了OneDrive。OneDrive的优点是可以直接从文件系统读写数据，且不需要手动处理设备离线等问题。

作为一个支持离线操作的笔记工具，需要采取一定措施保证不同设备上数据的一致性，目前candies在有数据更新时的方案大致是这样的：

1. 更新本地的MongoDB笔记数据库
2. 把数据更新作为一条操作记录添加到本地的MongoDB操作记录数据库
3. 每隔一段时间或者手动触发，执行“同步”，将所有操作记录导出为数据文件并清空，上传到网盘上的设备名文件夹下
4. “同步”还会从网盘上检索其他设备最新的未导入操作记录，读取并更新本地的MongoDB笔记数据库
5. “同步”结束后更新每个设备的最新操作记录时间

早期设计的一些同步方案出现过遗漏、旧操作覆盖新操作的问题，此方案截至撰写本部分时已经稳定运行1年半，目前还未出现明显错误

### 版本名称

UI经过了一次更新，很可惜并没有保存第一版Candies的界面。现在的版本名称是“透明发卡”，和界面风格是匹配的

此前的版本名称是“草莓蛋糕”

## 技术栈

前端Angular，后端ASP.NET，数据库MongoDB
